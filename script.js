import*as THREE from"three";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";const renderer=new THREE.WebGLRenderer({antialias:!0}),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);camera.position.z=1,camera.position.y=.5,renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement);const pdfdownload=document.getElementById("resumedownload"),emailcopy=document.getElementById("Email"),linkedinbutton=document.getElementById("linkedin"),closeButton=document.getElementById("close-about"),modelDiv=document.getElementById("model");modelDiv.appendChild(renderer.domElement);const model=document.getElementById("model"),aboutWindow=document.getElementById("about-window"),name=document.querySelector(".name"),aboutButton=document.getElementById("about"),portfolioButton=document.getElementById("projects");scene.background=new THREE.Color(16119260);const intersectionPoint=new THREE.Vector3,target=new THREE.Object3D,planeNormal=new THREE.Vector3,plane=new THREE.Plane,raycaster=new THREE.Raycaster,mousePosition=new THREE.Vector2;let mixer,armAnimationClip,headBone,tabletModel,followMouse=!0;const newRotationX=THREE.MathUtils.degToRad(90),newRotationY=THREE.MathUtils.degToRad(0),newRotationZ=THREE.MathUtils.degToRad(180),loader=(new GLTFLoader).setPath("/Models/");loader.load("Me11.glb",(e=>{const t=e.scene,n=(new THREE.Box3).setFromObject(t),o=new THREE.Vector3;n.getCenter(o),t.position.sub(o),t.scale.set(1,1,1),tabletModel=e.scene.getObjectByName("tablet"),scene.add(t);const i=e.animations,a="metarigAction";if(armAnimationClip=i.find((e=>e.name===a)),armAnimationClip){if(i&&i.length){mixer=new THREE.AnimationMixer(t);const e=mixer.clipAction(i.find((e=>"Key.003Action"===e.name)));e&&e.play()}headBone=t.getObjectByName("head"),headBone.rotation.x=Math.PI/2}else console.error(`Arm animation clip not found for: "${a}". Please double-check the animation name.`)}),void 0,(e=>{console.error("Model loading error:",e)}));let lastUpdateTime=0;function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function debounce(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}}window.addEventListener("mousemove",(function(e){const t=Date.now();t-lastUpdateTime<16||(lastUpdateTime=t,mousePosition.x=e.clientX/window.innerWidth*2-1,mousePosition.y=-e.clientY/window.innerHeight*2.5+1,planeNormal.copy(camera.position).normalize(),plane.setFromNormalAndCoplanarPoint(planeNormal,scene.position),raycaster.setFromCamera(mousePosition,camera),raycaster.ray.intersectPlane(plane,intersectionPoint),target.position.set(intersectionPoint.x,intersectionPoint.y,2))})),window.addEventListener("resize",debounce(onWindowResize,200));let isAnimating=!0;function animate(){isAnimating&&(requestAnimationFrame(animate),mixer&&mixer.update(.01),followMouse&&headBone&&headBone.lookAt(target.position),renderer.render(scene,camera))}async function loadGSAP(){const{gsap:e}=await import("gsap");return e}function startAnimation(){isAnimating=!0,animate()}function stopAnimation(){isAnimating=!1}startAnimation(),aboutButton.addEventListener("click",(function(){followMouse=!1;const e=new THREE.Vector3(Math.PI/1.65,0,0);model.classList.add("move-right"),aboutWindow.classList.add("show");const t=()=>{headBone.rotation.x+=.05*(e.x-headBone.rotation.x),headBone.rotation.y+=.05*(e.y-headBone.rotation.y),headBone.rotation.z+=.05*(e.z-headBone.rotation.z),Math.abs(headBone.rotation.x-e.x)>.01||Math.abs(headBone.rotation.y-e.y)>.01||Math.abs(headBone.rotation.z-e.z)>.01?requestAnimationFrame(t):armAnimationClip?gsap.to(headBone.rotation,{x:e.x,y:e.y,z:e.z,duration:1,ease:"power1.inOut",onComplete:()=>{console.log("Head rotation animation completed")}}):console.error("Arm animation clip not found")};t(),linkedinbutton.addEventListener("click",(function(){window.open("https://www.linkedin.com/in/daniyal-bhatti/","_blank")})),pdfdownload.addEventListener("click",(function(){window.open("/Models/Daniyal_Bhatti_Resume.pdf","_blank")})),emailcopy.addEventListener("click",(function(){const e="danibatty00@gmail.com",t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t),alert("Custom text copied to clipboard: "+e)}))})),closeButton.addEventListener("click",(function(){if(armAnimationClip){mixer.clipAction(armAnimationClip).stop()}followMouse=!0,model.classList.remove("move-right"),aboutWindow.classList.remove("show")})),document.getElementById("projects").addEventListener("click",(async function(){aboutWindow.classList.remove("show"),model.classList.remove("move-right"),name.style.transform="translateY(-100)",name.style.opacity="0",aboutButton.style.opacity="0",portfolioButton.style.opacity="0",gsap.to(tabletModel.rotation,{x:newRotationX,y:newRotationY,z:newRotationZ,duration:1.5,ease:"power1.inOut"}),gsap.to(camera.position,{z:.1,x:-.08,y:.08,duration:2,ease:"power1.inOut"}),gsap.to(camera.rotation,{x:-.5,duration:2,ease:"power1.inOut"}),setTimeout((function(){window.location.href="portfolio.html"}),1800)}));